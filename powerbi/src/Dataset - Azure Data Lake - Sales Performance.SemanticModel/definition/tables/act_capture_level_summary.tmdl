table act_capture_level_summary
	lineageTag: 000847f7-9192-461b-a532-21ff165a1ddd

	measure _debug_start_val_optimal =
			
			VAR Label = SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(TRIM([meas.opps_optimal_disc_level]),"%",""),"+",""),UNICHAR(8211),"-"),UNICHAR(8212),"-")," ","")
			VAR DashPos = FIND("-", Label, 1, 0)
			RETURN IF(DashPos>0, VALUE(LEFT(Label,DashPos-1)), VALUE(Label))
		lineageTag: 4fab1bad-4b3d-429e-ade2-27c7d1282685

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	measure _debug_won_amt_check =
			
			CALCULATE(
			    SUM(ssr_history[opp_won_amt]),
			    TREATAS(
			        VALUES( FORMAT(opps[_sys_doc_id], "") ),
			        ssr_history[_sys_doc_id]
			    )
			)
		lineageTag: e4f646aa-21f9-4fab-8972-67ed25c4772b

	measure Measure
		lineageTag: e8173c43-d77a-4aee-a303-299812fe7ce6

		annotation 43dbc3e8-3a1c-4b6f-9923-b49ff7d6691c = True

	column sort
		formatString: 0
		lineageTag: d5477c80-d67a-4f28-a71f-88ccd6353074
		summarizeBy: sum
		isNameInferred
		sourceColumn: [sort]

		annotation SummarizationSetBy = Automatic

	column _sys_docid
		lineageTag: 17fb9331-55b2-4a65-888f-60610819b97a
		summarizeBy: none
		isNameInferred
		sourceColumn: [_sys_docid]

		annotation SummarizationSetBy = Automatic

	column _sys_user_id
		lineageTag: ad66f36c-a040-4415-8edf-05a8dacdbca0
		summarizeBy: none
		isNameInferred
		sourceColumn: [_sys_user_id]

		annotation SummarizationSetBy = Automatic

	column _sys_filter_start_date
		formatString: General Date
		lineageTag: 18e3cdb2-3dda-414e-b7b4-95bc81df1ae0
		summarizeBy: none
		isNameInferred
		sourceColumn: [_sys_filter_start_date]

		variation Variation
			isDefault
			relationship: 70a3fab4-57d3-4042-a552-48814eddbb4a
			defaultHierarchy: LocalDateTable_5b05e348-650f-43cc-bd93-4a7e09ed398e.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

	column _sys_filter_end_date
		formatString: General Date
		lineageTag: 306bab70-e8d6-4f2f-861e-3a58fc1cd295
		summarizeBy: none
		isNameInferred
		sourceColumn: [_sys_filter_end_date]

		variation Variation
			isDefault
			relationship: 79109e15-3053-448b-aed5-24d3090aabfd
			defaultHierarchy: LocalDateTable_d6eca468-3e02-4d61-8174-4ee8c28a9d1d.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

	column full_name
		lineageTag: ade3ec7a-eaae-4572-8409-d43b723080e2
		summarizeBy: none
		isNameInferred
		sourceColumn: [full_name]

		annotation SummarizationSetBy = Automatic

	column user_role_function
		lineageTag: 539c7295-3670-406c-93ae-420c171c7479
		summarizeBy: none
		isNameInferred
		sourceColumn: [user_role_function]

		annotation SummarizationSetBy = Automatic

	column step_id
		formatString: 0
		lineageTag: 3bcd9903-defd-42c5-8bac-67971bebf046
		summarizeBy: sum
		isNameInferred
		sourceColumn: [step_id]

		annotation SummarizationSetBy = Automatic

	column step_name
		lineageTag: f63250ee-a334-4bed-8685-1dbf35dbd4ba
		summarizeBy: none
		isNameInferred
		sourceColumn: [step_name]

		annotation SummarizationSetBy = Automatic

	column crm_activity_count
		formatString: 0
		lineageTag: 2bbe305f-3eb6-4b94-a5de-32abbd85f8fe
		summarizeBy: sum
		isNameInferred
		sourceColumn: [crm_activity_count]

		annotation SummarizationSetBy = Automatic

	column steps
		formatString: 0
		lineageTag: 98687fa6-bffe-4b5b-98d9-6f1364836b98
		summarizeBy: sum
		isNameInferred
		sourceColumn: [steps]

		annotation SummarizationSetBy = Automatic

	column time_alloc
		lineageTag: 292edb80-cf46-4036-9529-d60dd21d871a
		summarizeBy: sum
		isNameInferred
		sourceColumn: [time_alloc]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column time_alloc_eng
		lineageTag: abce36ae-34a6-406d-bc8f-a3e22a3ce860
		summarizeBy: sum
		isNameInferred
		sourceColumn: [time_alloc_eng]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column time_alloc_no_eng
		lineageTag: eee4de94-ae24-418e-9788-86ebd9cf4697
		summarizeBy: sum
		isNameInferred
		sourceColumn: [time_alloc_no_eng]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column total_duration
		lineageTag: 40d70502-8aea-4f2b-8552-15160890f319
		summarizeBy: sum
		isNameInferred
		sourceColumn: [total_duration]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column expect_duration
		lineageTag: ff31b5a8-13a1-4c97-92f8-47af2cab939e
		summarizeBy: sum
		isNameInferred
		sourceColumn: [expect_duration]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column capped_duration
		lineageTag: 24f709fd-bcbf-4a45-a52a-46d82320a0b8
		summarizeBy: sum
		isNameInferred
		sourceColumn: [capped_duration]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column month_to_week_adjustment
		lineageTag: 4d08139c-2b6e-49ab-8a52-ed28c197fa69
		summarizeBy: sum
		isNameInferred
		sourceColumn: [month_to_week_adjustment]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column act_capture_level
		lineageTag: 6706cc8f-300f-4b95-8bf2-072305447924
		summarizeBy: sum
		isNameInferred
		sourceColumn: [act_capture_level]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column act_capture_level_conf
		lineageTag: dd1aacd1-5fbd-4030-bfc8-8992816bdefe
		summarizeBy: sum
		isNameInferred
		sourceColumn: [act_capture_level_conf]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column raw_ratio
		lineageTag: 30f623fa-d382-48d8-af2b-ec7632459177
		summarizeBy: sum
		isNameInferred
		sourceColumn: [raw_ratio]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column capped_ratio
		lineageTag: 1a5287ea-a4d7-4a9c-b856-e7477f1dc38f
		summarizeBy: sum
		isNameInferred
		sourceColumn: [capped_ratio]

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	partition act_capture_level_summary = calculated
		mode: import
		source = ```
				
				var year = Year(max(cal_end_dates[date]) ) -1 // get the full year prior
				var filter_date =filter(users_history, users_history[_sys_filt_end_date] >= date(year,1,1) && users_history[_sys_filt_end_date] < date(year+1,1,1)  )  // get teh 1 year filter period
				var filt_prospecting = filter(filter_date,   users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur] > 500 ) // get items that prospecting
				var filt_new_logo = filter(filter_date,   users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur] > 500 ) // get items that new_logo
				var filt_post_sales = filter(filter_date,   users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur] > 500 ) // get items that filt_post_selling
				var filt_existing_cust = filter(filter_date,   users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur] > 500 ) // get items that filt_existing customer selling
				var filt = filter_date
				var tbl_summary = UNION(
				
				 SELECTCOLUMNS(filt_prospecting, "sort", 1, "_sys_docid", users_history[_sys_doc_id],  "_sys_user_id", users_history[_sys_user_id],  "_sys_filter_start_date", users_history[_sys_filt_start_date],    "_sys_filter_end_date", users_history[_sys_filt_end_date],   "full_name", related(users[trueai_full_name]),"user_role_function", related(users[trueai_user_role_function]),
				 "step_id", 3, "step_name", "Prospecting", "crm_activity_count",  users_history[ci_act_capt_lvl_pi_prospecting_owner_act] , "steps", users_history[ci_act_capt_lvl_pi_prospecting_steps],
				 "time_alloc", users_history[ci_time_alloc_prospecting],   
				"time_alloc_eng", users_history[ci_time_alloc_prospecting_eng], 
				"time_alloc_no_eng", users_history[ci_time_alloc_prospecting] - users_history[ci_time_alloc_prospecting_eng],
				 "total_duration" , users_history[ci_act_capt_lvl_pi_prospecting_owner_dur],"expect_duration" , users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur], 
				 "capped_duration" , If(users_history[ci_act_capt_lvl_pi_prospecting_owner_dur] >  users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur] ,  users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur] * 0.95,users_history[ci_act_capt_lvl_pi_prospecting_owner_dur]) ,
				  "month_to_week_adjustment", users_history[ci_time_alloc_month_to_week_adjustment],
				  "act_capture_level", users_history[ci_act_capt_lvl],
				    "act_capture_level_conf", users_history[ci_act_capt_lvl_conf],
				 "raw_ratio", divide(users_history[ci_act_capt_lvl_pi_prospecting_owner_dur], users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur]),
				  "capped_ratio",  if(divide(users_history[ci_act_capt_lvl_pi_prospecting_owner_dur], users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur]) > .95, .95,divide(users_history[ci_act_capt_lvl_pi_prospecting_owner_dur], users_history[ci_act_capt_lvl_pi_prospecting_expect_owner_dur]))  // cap @ 95%
				 
				 ), // prospecting
				
				 SELECTCOLUMNS(filt_new_logo, "sort", 2,  "_sys_docid", users_history[_sys_doc_id],  "_sys_user_id", users_history[_sys_user_id],  "_sys_filter_start_date", users_history[_sys_filt_start_date],  "_sys_filter_end_date", users_history[_sys_filt_end_date], "full_name", related(users[trueai_full_name]),"user_role_function", related(users[trueai_user_role_function]) ,
				 "step_id", 4,"step_name", "New Logo Selling", "crm_activity_count", users_history[ci_act_capt_lvl_pi_new_logo_owner_act] , "steps", users_history[ci_act_capt_lvl_pi_new_logo_steps],
				 "time_alloc", users_history[ci_time_alloc_new_logo],   
				"time_alloc_eng", users_history[ci_time_alloc_new_logo_eng], 
				"time_alloc_no_eng", users_history[ci_time_alloc_new_logo] - users_history[ci_time_alloc_new_logo_eng],
				 "total_duration" , users_history[ci_act_capt_lvl_pi_new_logo_owner_dur],"expect_duration" , users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur],
				 "capped_duration" , If(users_history[ci_act_capt_lvl_pi_new_logo_owner_dur] >  users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur] ,  users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur]  * 0.95,users_history[ci_act_capt_lvl_pi_new_logo_owner_dur]) ,
				 "month_to_week_adjustment", users_history[ci_time_alloc_month_to_week_adjustment],
				 "act_capture_level", users_history[ci_act_capt_lvl],
				 "act_capture_level_conf", users_history[ci_act_capt_lvl_conf],
				 "raw_ratio", divide(users_history[ci_act_capt_lvl_pi_new_logo_owner_dur], users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur]),
				 "capped_ratio", if(divide(users_history[ci_act_capt_lvl_pi_new_logo_owner_dur], users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur])> .95, .95,divide(users_history[ci_act_capt_lvl_pi_new_logo_owner_dur], users_history[ci_act_capt_lvl_pi_new_logo_expected_owner_dur]))  // cap @ 95%
				 ), // new logo selling
				
				  SELECTCOLUMNS(filt_post_sales, "sort", 3,  "_sys_docid", users_history[_sys_doc_id],  "_sys_user_id", users_history[_sys_user_id],  "_sys_filter_start_date", users_history[_sys_filt_start_date],  "_sys_filter_end_date", users_history[_sys_filt_end_date], "full_name", related(users[trueai_full_name]),"user_role_function", related(users[trueai_user_role_function]) ,
				  "step_id", 5,"step_name", "Post-Sales Support", "crm_activity_count", users_history[ci_act_capt_lvl_pi_post_sales_owner_act], "steps", users_history[ci_act_capt_lvl_pi_post_sales_steps],
				 "time_alloc", users_history[ci_time_alloc_post_sales],   
				"time_alloc_eng", users_history[ci_time_alloc_post_sales_eng], 
				"time_alloc_no_eng", users_history[ci_time_alloc_post_sales] - users_history[ci_time_alloc_post_sales_eng],
				 "total_duration" , users_history[ci_act_capt_lvl_pi_post_sales_owner_dur],"expect_duration" , users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur],
				 "capped_duration" , If(users_history[ci_act_capt_lvl_pi_post_sales_owner_dur] >  users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur] ,  users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur]  * 0.95,users_history[ci_act_capt_lvl_pi_post_sales_owner_dur]) ,
				 "month_to_week_adjustment", users_history[ci_time_alloc_month_to_week_adjustment],
				 "act_capture_level", users_history[ci_act_capt_lvl],
				     "act_capture_level_conf", users_history[ci_act_capt_lvl_conf],
				 "raw_ratio", divide(users_history[ci_act_capt_lvl_pi_post_sales_owner_dur], users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur]),
				 "capped_ratio", if(divide(users_history[ci_act_capt_lvl_pi_post_sales_owner_dur], users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur])> .95, .95,divide(users_history[ci_act_capt_lvl_pi_post_sales_owner_dur], users_history[ci_act_capt_lvl_pi_post_sales_expect_owner_dur]))  // cap @ 95%
				 ), // post_sales
				
				 SELECTCOLUMNS(filt_existing_cust, "sort", 4,  "_sys_docid", users_history[_sys_doc_id],  "_sys_user_id", users_history[_sys_user_id],  "_sys_filter_start_date", users_history[_sys_filt_start_date],  "_sys_filter_end_date", users_history[_sys_filt_end_date], "full_name", related(users[trueai_full_name]),"user_role_function", related(users[trueai_user_role_function]) ,
				 "step_id", 6,"step_name", "Existing Customer Selling", "crm_activity_count", users_history[ci_act_capt_lvl_pi_exist_cust_owner_act] , "steps", users_history[ci_act_capt_lvl_pi_exist_cust_steps],
				 "time_alloc", users_history[ci_time_alloc_existing_customer_selling],   
				"time_alloc_eng", users_history[ci_time_alloc_existing_customer_selling_eng], 
				"time_alloc_no_eng", users_history[ci_time_alloc_existing_customer_selling] - users_history[ci_time_alloc_existing_customer_selling_eng],
				 "total_duration" , users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur],"expect_duration" , users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur],
				 "capped_duration" , If(users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur] >  users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur] ,  users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur]  * 0.95,users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur]) ,
				  "month_to_week_adjustment", users_history[ci_time_alloc_month_to_week_adjustment],
				  "act_capture_level", users_history[ci_act_capt_lvl],
				      "act_capture_level_conf", users_history[ci_act_capt_lvl_conf],
				 "raw_ratio", divide(users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur], users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur]),
				 "capped_ratio", if(divide(users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur], users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur])> .95, .95,divide(users_history[ci_act_capt_lvl_pi_exist_cust_owner_dur], users_history[ci_act_capt_lvl_pi_exist_cust_expect_owner_dur]))  // cap @ 95% // Existing Customer Selling
				
				)
				)
				
				return tbl_summary
				
				```

	annotation PBI_Id = ab856beed7b941b8997a9e98a9fdb5d6

